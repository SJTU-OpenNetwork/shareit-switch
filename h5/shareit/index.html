<!DOCTYPE html>
<html>

<head>
	<meta charset="UTF-8">
	<title>Sharit</title>
	<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="black">
	<!--标准mui.css-->
	<link rel="stylesheet" href="css/mui.min.css">
	<!--App自定义的css-->
	<link rel="stylesheet" type="text/css" href="css/app.css" />
	<script type="text/javascript" src="./public/jquery-1.8.3.min.js"></script>
	<script type="text/javascript" src="./public/framework.min.js"></script>
	<script type="text/javascript" src="./public/public_router.js"></script>
</head>

<body>
	<h1 class="title">Shareit Switch</h1>
	<div class="wrap">
		<h3 class="title-sub">绑定用户列表</h3>
		<!--<button class="add_btn" onclick="addnode()"></button>-->
		<span class="mui-icon mui-icon-plus" onclick="addnode()"></span>
		<div class="mui-content">
			<ul id="OA_task_1" class="mui-table-view">
			</ul>
		</div>
	</div>
	<script>
		function addnode() {
			mui.prompt("", "", '添加节点', ['确定', '取消'], function (e) {
				console.log(e.value);
				addWhiteList(e.value);
			}, 'div')
		}
		window.onload = function () {
			startNode();
			getWhiteList();
		}
		var url_post = "/shareit/postCmd";
		function postSuccess(result) {
			console.log(result);
			getWhiteList();
		}
		function postCmdUtil(cmdType1, cmd1) {
			var postCmd = {
				"cmdType": cmdType1,
				"cmd": cmd1
			}
			var submitData = JSON.stringify(postCmd);
			console.log(submitData);
			hilink.setResource(url_post, submitData, "postSuccess");
		}
		function addWhiteList(add_peerid) {
			if (add_peerid == "") {
				//alert("输入不能为空");
			} else {
				postCmdUtil("addWhiteList", add_peerid)
			}
		}
		function startNode() {
			postCmdUtil("startNode", "")
		}
		function delWhiteList(obj) { //obj is the button
			console.log(obj);
			var peerId = obj.children[1].textContent;
			console.log(peerId)
			postCmdUtil("delWhiteList", peerId)
		}


		var url_get = "/shareit/getWhiteList";
		function getWhitelistSuccess(result) {
			var whiteResult = JSON.parse(result)
			console.log(whiteResult);
			$("#OA_task_1").empty();
			for (var i = 0; i < whiteResult.peerIdList.length; i++) {
				console.log(whiteResult.peerIdList[i])
				$("#OA_task_1").append('<li class="mui-table-view-cell">\n' +
					'\t\t\t\t\t<div class="mui-slider-right mui-disabled">\n' +
					'\t\t\t\t\t\t<a class="mui-btn mui-btn-red">删除</a>\n' +
					'\t\t\t\t\t</div>\n' +
					'\t\t\t\t\t<div class="mui-slider-handle">' +
					+whiteResult.peerIdList[i] +
					'</div>\n' +
					'\t\t\t\t</li>');
			}
		}
		function getWhiteList() {
			hilink.getResource(url_get, "getWhitelistSuccess");
			// getWhitelistSuccess('{"a":"b","peerIdList":["111","222","333"]}'); //test
		}

	</script>
	<script src="js/mui.min.js"></script>
	<script>
		mui.init();
		(function ($) {
			//$.swipeoutOpen(el,direction)//打开指定列的滑动菜单，el:指定列的dom对象，direction：取值left|right，指定打开的是左侧或右侧滑动菜单
			//$.swipeoutClose(el);//关闭指定列的滑动菜单，el:指定列的dom对象
			//				setTimeout(function() {
			//					$.swipeoutOpen(document.getElementById("OA_task_1").querySelector('li:last-child'), 'left');
			//					setTimeout(function() {
			//						$.swipeoutClose(document.getElementById("OA_task_1").querySelector('li:last-child'));
			//					}, 1000);
			//				}, 1000);
			//第一个demo，拖拽后显示操作图标，点击操作图标删除元素；
			$('#OA_task_1').on('tap', '.mui-btn', function (event) {
				var elem = this;
				var li = elem.parentNode.parentNode;
				mui.confirm('确定删除此节点？', '删除节点', btnArray, function (e) {
					if (e.index == 0) {
						li.parentNode.removeChild(li);
						delWhiteList(li);
					} else {
						setTimeout(function () {
							$.swipeoutClose(li);
						}, 0);
					}
				});
			});
			var btnArray = ['确认', '取消'];
		})(mui);
	</script>
</body>

</html>